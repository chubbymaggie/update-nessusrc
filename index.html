<HTML>
<HEAD>
<TITLE>update-nessusrc</TITLE>
<LINK REV="made" HREF="mailto:theall@tifaware.com">
</HEAD>

<!--#include virtual="/header.html"-->
<!--#if expr="$weblint" -->
<BODY BGCOLOR="#FFFFFF">
<!--#endif -->


<H2>update-nessusrc</H2>

<H3>Introduction</H3>

<P><A HREF="http://www.nessus.org/">Nessus</A> is a high-quality and
free remote vulnerability scanner.  While its initial cost is certainly
attractive, arguably its main advantage is its extensive and continually
evolving plugin database of vulnerability checks.  Additionally, the
discussion about <A
HREF="http://www.nessus.org/doc/detached_scan.html">detached scans</A>,
suggests that one can configure Nessus to constantly scan a network with
a continuously updated collection of plugins with minimal user
interaction -- an extremely appealing notion!</P>

<P>In practice, though, this notion doesn't work, at least not directly. 
The reason is that each plugin must be listed in a client configuration
file and that, out-of-the-box, the only way to update this file is via
the GUI manually.</P>

<P>To get around this shortcoming, I've written <B>update-nessusrc</B>,
which queries a Nessus server for its list of available plugins and
updates a Nessus client configuration file named on the commandline. 
Specifically, it completely updates the sections
<CODE>SCANNER_SET</CODE> and <CODE>PLUGIN_SET</CODE> whenever it is run. 
When used periodically along with <CODE>nessus-update-plugins</CODE>, it
ensures your client configuration files are as current as possible.</P>

<P><B>update-nessusrc</B> is written in Perl and calls the Nessus client
to obtain a list of current plugins (using the option <CODE>-p</CODE>). 
It should work on any unix-like system with Perl 5 and Nessus 1.1.14 or
better.</P>

<P>Note: there is also a Python script named <A
HREF="http://www.edgeos.com/software/">update-nessusrc</A>, written by
Jay Jacobson.  Currently, it offers much the same functionality as this
script but also supports updates based on plugin families.</P>


<H3>Installation</H3>

<OL>
   <LI>Retrieve the script <A HREF="update-nessusrc">update-nessusrc</A>
      and save it locally.  You may also wish to verify its
      <A HREF="update-nessusrc.md5">MD5 checksum</A> or, better, its
      <A HREF="update-nessusrc.asc">GPG signature</A> against
      <A HREF="/~theall/gpg.html">my current GPG key</A>.</LI>
   <LI>Verify ownership and permissions on the script - it can (and
      probably should) be invoked as an ordinary user rather than root 
      and will hold a userid and password used to connect with a Nessus 
      server.</LI>
   <LI>Edit the script and set <CODE>$nessusd_host</CODE>, 
      <CODE>$nessusd_port</CODE>, <CODE>$nessusd_user</CODE>, 
      and <CODE>$nessusd_user_pass</CODE> according to your environment. 
      Also, you may wish to adjust the location of the perl interpreter 
      in the first line, <CODE>@plugin_cats</CODE>, 
      <CODE>@plugin_excludes</CODE>, and/or <CODE>@plugin_includes</CODE> 
      to suit your tastes.</LI>
</OL>


<H3>Use</H3>

<P>The script offers considerable control in the selection of plugins -
either by editing variables in the script or by commandline arguments,
you can include entire categories of plugins, include specific plugins,
or exclude specific plugins.</P>

<P>There are several commandline arguments you can use to override 
variables defined in the script itself:</P>

<BLOCKQUOTE>
<DL>
   <DT>-d, --debug</DT>
   <DD>Display debugging messages while running.  Creates a scratch
      configuration file but doesn't actually replace the original
      one.</DD>

   <DT>-c, --categories &lt;plugin categories&gt;</DT>
   <DD>Enable all plugins in the specified categories, overriding
      <CODE>@plugin_cats</CODE>. Valid categories are:
      <UL>
         <LI><I>attack</I> - may steal info but does no harm.</LI>
         <LI><I>denial</I> - tries to perform a DoS.</LI>
         <LI><I>destructive_attack</I> - tries to kill services / software.</LI>
         <LI><I>infos</I> - gathers info about services / software.</LI>
         <LI><I>kill_host</I> - tries to kill OS (starting with Nessus 1.3.0).</LI>
         <LI><I>mixed</I> - mixed attack.</LI>
         <LI><I>scanner</I> - port scanners / ping.</LI>
         <LI><I>settings</I> - sets options but doesn't do tests. NB: 
            Nessus will always enable this category.</LI>
      </UL>
      Note, though, that the actual categories available to you will depend 
      on the version of Nessus installed.</DD>

   <DT>-x, --excludes &lt;plugin ids&gt;</DT>
   <DD>Exclude the specified plugin ids, overriding 
      <CODE>@plugin_excludes</CODE>.  Note: plugins explicitly excluded 
      will never be used regardless of the other variables or 
      commandline options.</DD>

   <DT>-i, --includes &lt;plugin ids&gt;</DT>
   <DD>Include the specified plugin ids, overriding 
      <CODE>@plugin_includes</CODE>.</DD>
</DL>
</BLOCKQUOTE>

<P>Notes:</P>
<UL>
   <LI>For a list of all plugin ids, see <A
      HREF="http://cgi.nessus.org/plugins/">http://cgi.nessus.org/plugins/</A>. 
      For a list of plugin categories, see the file <CODE>doc/WARNING.En</CODE>
      in the nessus-core source.</LI>

   <LI>Plugins classified as <CODE>settings</CODE> will always be run 
      regardless of what's in the configuration file.  These plugins
      only update the knowledge bases, they do not actually send any 
      packets.</LI>

   <LI>Commandline arguments take precedence over variables defined in the
      script. For example, you can disable all plugin categories by using
      the commandline argument <CODE>-c ""</CODE>.</LI>

   <LI>Plugins explicitly excluded will never be used regardless of the other
      variables or commandline options.</LI>

   <LI>Multiple categories / plugin ids can be specified either by a
      comma-delimited string or by multiple argument pairs.  For example,
      <CODE>-c "settings,infos"</CODE> is equivalent to <CODE>-c settings -c
      infos</CODE>.</LI>
</UL>

<P>Examples:</P>
<BLOCKQUOTE>
<DL>
   <DT><CODE>update-nessusrc ~/.nessusrc</CODE></DT>
   <DD>updates default nessusrc w/ non-destructive plugins and ping /
      nmap_wrapper scanners.</DD>

   <DT><CODE>update-nessusrc -d ~/.nessusrc</CODE></DT>
   <DD>produces an alternate nessusrc without replacing original and
      also prints lots of debugging info.</DD>

   <DT><CODE>update-nessusrc -c "denial,destructive_attack" -i 10335 ~/.nessusrc-dos</CODE></DT>
   <DD>updates special nessusrc w/ DoS plugins and tcp connect() scanner.</DD>
</DL>
</BLOCKQUOTE>


<H3>Known Bugs and Caveats</H3>

<P>Currently, I am not aware of any bugs in this script.</P>

<P>This script is not a substitute for the Nessus client in terms of
managing a configuration file or server certificates.  On one hand,
several plugins require additional configuration - simply adding them to
the list of plugins used may not be optimal.  On the other, the script
currently makes no provisions for cases in which the client prompts the
user with information about server certificates.  If you absolutely can
not run the client as a GUI, here are some points to keep in mind:</P>

<UL>
   <LI><B>update-nessusrc</B> requires that the configuration file 
      contain lines delimiting the <CODE>SCANNER_SET</CODE> and 
      <CODE>PLUGIN_SET</CODE> sections for them to be replaced. It 
      will not add them if they are not already present.</LI>

   <LI>If you are using SSL to encrypt client-server communications,
      you will need to run the client at least once to connect to the
      server and accept the certificate it presents, otherwise, 
      <B>update-nessusrc</B> will hang when run.  One way to do this
      is to run <B>update-nessusrc</B> in debug mode and break out of it
      when it displays the server's certificate; then, run the client 
      manually using the same commandline as <B>update-nessusrc</B>.</LI>
</UL>

<P>This script does not report the changes made to the nessusrc file, it
just does them.</P>

<P>Finally, realize that this script will hold a userid and password
used to connect to a Nessus server; protect it accordingly!</P>


<H3>Copyright and License</H3>

<P>Copyright (c) 2003, George A. Theall.<BR>
All rights reserved.</P>

<P>This script is free software; you can redistribute it and/or modify
it under the same terms as Perl itself.</P>


<H3>History</H3>

<CENTER>
<TABLE CELLPADDING="5" CELLSPACING="0" WIDTH="95%" BORDER="1">
   <TR>
      <TH ALIGN="left">Date </TH>
      <TH ALIGN="left">Version </TH>
      <TH ALIGN="left">Verification </TH>
      <TH ALIGN="left">Notes<BR></TH>
   </TR>
   <TR>
      <TH ALIGN="left" VALIGN="top">17-Feb-2003 </TH>
      <TD ALIGN="left" VALIGN="top"><A HREF="update-nessusrc-1.10">1.10</A> </TD>
      <TD ALIGN="left" VALIGN="top"><A HREF="update-nessusrc-1.10.md5">MD5</A> / 
         <A HREF="update-nessusrc-1.10.asc">GPG</A> </TD>
      <TD ALIGN="left" VALIGN="top">
      <UL>
         <LI>Am now allowing nessusd port to be configured.</LI>
         <LI>Removed support for <CODE>-s</CODE> option since I discovered 
            Nessus actually treats plugins not listed in a configuration 
            file as enabled.</LI>
         <LI>Added support for plugin categories introduced in 
            Nessus 1.3.0.</LI>
         <LI>Am now reporting an error if the nessus client produces 
            an error, as opposed to can't be run.</LI>
      </UL></TD>
   </TR>
   <TR>
      <TH ALIGN="left" VALIGN="top">19-Jan-2003 </TH>
      <TD ALIGN="left" VALIGN="top"><A HREF="update-nessusrc-1.01">1.01</A> </TD>
      <TD ALIGN="left" VALIGN="top"><A HREF="update-nessusrc-1.01.md5">MD5</A> / 
         <A HREF="update-nessusrc-1.01.asc">GPG</A> </TD>
      <TD ALIGN="left" VALIGN="top">
      <UL>
         <LI>Am now passing along the specified rcfile when invoking 
            the client so settings such as <CODE>cert_file</CODE> and 
            <CODE>key_file</CODE> in that file will be used.</LI>
      </UL></TD>
   </TR>
   <TR>
      <TH ALIGN="left" VALIGN="top">13-Jan-2003 </TH>
      <TD ALIGN="left" VALIGN="top"><A HREF="update-nessusrc-1.00">1.00</A> </TD>
      <TD ALIGN="left" VALIGN="top"><A HREF="update-nessusrc-1.00.md5">MD5</A> / 
         <A HREF="update-nessusrc-1.00.asc">GPG</A> </TD>
      <TD ALIGN="left" VALIGN="top">
      <UL>
         <LI>Initial version.</LI>
      </UL></TD>
   </TR>
</TABLE>
</CENTER>

<!--#include virtual="/footer.html" -->
<!--#if expr="$weblint" -->
</BODY>
<!--#endif -->
</HTML>
